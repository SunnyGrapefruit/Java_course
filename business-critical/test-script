import org.junit.Assert;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.FindBy;
import org.openqa.selenium.support.PageFactory;

public class AdressForm {

    private static String URL_MATCH = "registration";
    private WebDriver driver;

    @FindBy(id = "adressFrom")
    private WebElement adressFrom;

    @FindBy(id = "adressTo")
    private WebElement adressTo;

    @FindBy(id = "phoneNumber")
    private WebElement phoneNumber;

    @FindBy(id = "callTaxi")
    private WebElement submitTaxi;

    @FindBy(id = "error-message-adress")
    private WebElement adressError;

    @FindBy(id = "error-message-phone")
    private WebElement phoneError;


    public AdressForm(WebDriver driver) {
        // проверить, что вы находитесь на верной странице
        if (!driver.getCurrentUrl().contains(URL_MATCH)) {
            throw new IllegalStateException(
                    "This is not the page you are expected"
            );
        }
        PageFactory.initElements(driver, this);
        this.driver = driver;
    }

    /**
     * Ввод адреса
     * @param adress - {@link Adress}
     */
    private void inputAdress(Adress adress) {
        adressFrom.sendKeys(adress.adressFrom);
        adressTo.sendKeys(adress.adressTo);
        phoneNumber.sendKeys(adress.phoneNumber);
        submitTaxi.click();
    }

    /**
     * Успешный ввод адреса
     * @param adress - {@link Adress}
     * @return {@link ConfirmForm}
     */
    public ConfirmForm callTaxiSuccess(Adress adress) {
        inputAdress(adress);
        return new ConfirmForm(driver);
    }

    /**
     * Неуспешный ввод адреса
     * @param adress - {@link Adress}
     * @return {@link AdressForm}
     */
    public AdressForm callTaxiError(Adress adress) {
        inputAdress(adress);
        return new AdressForm(driver);
    }

    /**
     * Проверить сообщение об ошибке
     * @param user - {@link User}
     * @return {@link RegistrationPage}
     */
    public AdressForm checkAdressErrorMessage(String errorMessage) {
        Assert.assertTrue("Error message should be present",
                adressError.isDisplayed());
        Assert.assertTrue("Error message should contains " + errorMessage,
                adressError.getText().contains(errorMessage));
        return this;
    }

    public AdressForm checkPhoneErrorMessage(String errorMessage) {
        Assert.assertTrue("Error message should be present",
                phoneError.isDisplayed());
        Assert.assertTrue("Error message should contains " + errorMessage,
                phoneError.getText().contains(errorMessage));
        return this;
    }
}

public class ConfirmForm{

    @FindBy(id = "confirmCode")
    private WebElement confirmCode;

    @FindBy(id = "confirmButton")
    private WebElement confirmButton;

    @FindBy(id = "tryAgainCode")
    private WebElement tryAgainCode;

    @FindBy(id = "cancelButton")
    private WebElement cancelButton;

    private void inputCode(Code code) {
        confirmCode.sendKeys(adress.adressFrom);
        confirmButton.click();
    }

    private void cancelTaxi{
        cancelButton.click();
    }


    /**
     * Успешный ввод кода
     * @param adress - {@link Adress}
     * @return {@link ConfirmForm}
     */
    public ConfirmForm callTaxiSuccess(Code code) {
        inputCode(adress);
        return new ConfirmForm(driver);
    }

    /**
     * Неуспешный ввод кода
     * @param adress - {@link Adress}
     * @return {@link AdressForm}
     */
    public ConfirmForm callTaxiError(Code code) {
        inputCode(adress);
        return AuthorizationErrorForm;
    }

    /**
     * Отмена такси
     * @param adress - {@link Adress}
     * @return {@link AdressForm}
     */

    public ConfirmForm cancelTaxi(Code code){
        cancelTaxi(code);
        return AdressForm(driver);
    }

}

public class AuthorizationErrorForm{

    @FindBy(id = "updatePage")
    private WebElement updatePageButton;

    @FindBy(id = "closePage")
    private WebElement closePageButton;

    private void updatePage(Code code) {
        updatePageButton.click();
    }

    private void closePage(Code code) {
        closePageButton.click();
    }

}



@Test
public void registerUserTest() {
    driver.get("https://taxi.yandex.ru/#index");

    Order order = Order.createValidOrder();
    order.adress = "not_valid_adress";

    AdressForm newOrder =  new AdressForm(driver);
    newOrder
            .callTaxiError(order)
            .checkAdressErrorMessage(errorMessage)
    ;


    Order order = Order.createValidOrder();
    order.phone = "not_valid_phone";

    AdressForm newOrder =  new AdressForm(driver);
    newOrder
            .callTaxiError(order)
            .checkPhoneErrorMessage(errorMessage)
    ;


    Order order = Order.createValidUser();
    AdressForm newOrder =  new AdressForm(driver);
    newOrder
            .callTaxiSuccess(order)
        // ...
        // вызов методов HomePage
    ;
}